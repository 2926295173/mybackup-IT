> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [book.qq.com](https://book.qq.com/book-read/46418409/14)

> QQ 阅读提供 Ghidra 权威指南, 第 5 章 Ghidra 数据显示在线阅读服务, 想看 Ghidra 权威指南最新章节, 欢迎关注 QQ 阅读 Ghidra 权威指南频道, 第一时间阅读 Ghidra 权威指南最新章节!

第 5 章 Ghidra 数据显示
-----------------

到这里我们已经可以创建项目、加载二进制文件并进行初始自动分析了。这些步骤完成后，Ghidra 就将控制权交到了你手中。正如第 4 章所说的，当你启动 Ghidra 时，你的冒险之旅将从项目窗口开始。然后，你从项目中打开一个文件，会出现第二个窗口，也就是 CodeBrowser，在这里进行大部分的逆向工程工作。前面你已经使用 CodeBrowser 完成了文件的自动分析，接下来我们会深入讲解 CodeBrowser 的菜单、窗口和基本选项，以提高你对 Ghidra 功能的认识，并能够创建一个最适合自己的逆向工程分析环境。现在让我们从主要的 Ghidra 数据显示开始。

### 5.1 CodeBrowser

在项目窗口中选择 Tools→RunTool→CodeBrowser 可以打开 CodeBrowser。虽然这一步通常是通过选择文件进行分析来实现的，但为了方便展示其功能和配置选项，此处选择打开一个空白实例，如图 5-1 所示。在其默认配置中，CodeBrowser 包含六个子窗口。在深入了解每个窗口的细节之前，我们先看一下 CodeBrowser 的菜单及相关功能。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_57_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dbc432271d5b888e3a05f8fa89be0b703d9b5c890)

图 5-1：空白的 CodeBrowser 窗口

CodeBrowser 窗口的顶部是主菜单，其下方有一个工具栏。工具栏提供了一些最常用菜单项的快捷方式按钮。由于目前没有加载文件，本节中我们主要关注与已加载文件无关的菜单项，其他的菜单操作将在后续逆向工程中进行演示和讲解。

**File** 提供大多数文件操作菜单都有的基本功能。包括打开 / 关闭、导入 / 导出、保存和打印等选项。此外，有一些选项是 Ghidra 特有的，例如工具选项，用于保存和操作 CodeBrowser 工具，以及解析 C 源代码选项，通过从 C 头文件中提取数据类型信息来帮助反编译过程。（参见 13.4 节的解析 C 头文件）

**Edit** 包含一个各子窗口以外通用的命令：Edit→Tool Options 命令。它会打开一个新窗口，用于控制与 CodeBrowser 中许多工具相关的参数和选项。与控制台相关的选项如图 5-2 所示。Restore Defaults 按钮（恢复为默认设置）始终出现在右下角。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_58_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dd1871555a3abe2737f669064a2c930f497a5d625)

图 5-2：CodeBrowser 控制台编辑选项

**Analysis** 用于重新分析二进制文件或者有选择地执行单个分析任务。基本的分析选项已经在第 4.3 节 “使用 Ghidra 分析文件” 中做了介绍。

**Navigation** 用于在文件内导航。提供了许多程序支持的基本键盘操作功能，并且为二进制文件添加了特殊的导航选项。虽然菜单中提供了在文件中移动的方法，但在你掌握了许多可用的导航选项之后，可能会直接使用工具栏或热键（位于每个菜单项的后侧）。

**Search** 提供了内存、程序文本、字符串、地址表、直接引用、指令模式等的搜索功能。基本的搜索功能会在 6.4 节介绍。更专业的搜索概念则在后续章节中作为示例的一部分进行讲解。

**Select** 提供了识别文件某一部分特定功能的能力，选择可以基于子例程、函数、控制流，或者简单地将所需部分高亮显示。

**Tools** 包含一些有趣的功能，可将额外的逆向工程资源放置到桌面。其中一个最有用的选项是 Processor Manual，它会将与当前文件相关的处理器手册显示出来。如果你试图打开一个缺失的处理器手册，那么系统会提供一个导入该手册的方法，如图 5-3 所示。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_59_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Da1cfa640024496a2cb5fadff310536b0a2c5dde9)

图 5-3：缺失处理器手册消息

**Window** 用于为你配置最适合的 Ghidra 工作环境。本章的大部分内容都在介绍和研究默认的 Ghidra 窗口，以及其他一些有用的窗口。

**Help** 提供丰富、结构清晰且非常详细的帮助信息。帮助窗口支持搜索、更改视图、收藏夹、缩放以及打印和页面设置等选项。

### 5.2 CodeBrowser 窗口

在图 5-4 中可以看到展开的 Window 菜单。默认情况下，CodeBrowser 启动时会打开六个可用窗口：程序树、符号树、数据类型管理器、清单、控制台和反编译器。每个窗口的名称都显示在左上方，并且在 Window 菜单中占据一个选项，有些窗口还在菜单正下方的工具栏上有对应图标（例如，图 5-4 中使用箭头标出的反编译器窗口图标和菜单项）。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_59_2.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Df6aacbbe8a2d9d724ec22157b2993f210b335bf5)

图 5-4：反编译器窗口图标和菜单项

下面让我们深入研究这六个默认窗口，从而理解它们在逆向过程中的重要性。

**热键、按钮和工具栏**

Ghidra 中几乎所有常用的操作都有对应的菜单项、热键和工具栏按钮，如果没有，你甚至可以创建它们。Ghidra 工具栏是高度可配置的，包括热键到菜单项的映射也是如此（参见 CodeBrowser Edit→Tool Options→Key Bindings，或者将鼠标指针悬停在命令上然后按 F4）。这似乎还不够，Ghidra 还为鼠标右键提供了好用的、上下文敏感的菜单项。尽管这些菜单项没有一份详细的清单作为说明，但它们确实可以起到很好的提醒作用。这种灵活性让你可以自定义工作环境并以最舒服的方式使用它们。

**窗口的内部和外部**

当你开始探索 Ghidra 的各种窗口时，可能会注意到，默认情况下，一些窗口会在 CodeBrowser 桌面内打开，而另一些窗口会在桌面外作为新的浮动窗口打开。让我们来谈谈这些内部和外部的窗口是怎么回事。

外部窗口浮动在 CodeBrowser 桌面之外，可能是有关联的也可能是独立的。这些窗口可以与 CodeBrowser 一起浏览，例如函数调用图、注释和内存映射。

内部窗口则可以分为三类：

· 默认打开的窗口（例如，符号树和清单窗口）；

· 与默认窗口堆叠的窗口（例如，字节窗口）；

· 新建或与其他 CodeBrowser 窗口共享空间的窗口（例如，等式表和外部程序窗口）。

当你打开的窗口是与另一个窗口共享空间的时候，它会出现在现有窗口的前面。共享同一空间的所有窗口都带有选项卡，从而方便在窗口之间快速切换。如果你想要同时查看其中的两个窗口，可以单击窗口的标题栏并将其拖到 CodeBrowser 外面。

需要注意的是，将一个外面的窗口放回 CodeBrowser 就不是那么容易了。更多细节参见 12.1.1 节的 “重新排列窗口”。

**我的窗口在哪里**

由于 Ghidra 有大量的窗口，所以，要想随时快速地定位到它们的位置不是那么容易，特别是当你打开了更多的窗口，其他窗口被隐藏在它们后面，或者消失在 CodeBrowser 和桌面上的时候。Ghidra 提供了一个独特的功能，可以帮你找到那些丢失的窗口。单击相关的工具栏按钮或者菜单项可以将特定的窗口移到前面来，更有意思的是，如果你一直单击，这些窗口就会尝试通过震动、更改字体大小或颜色、缩放、旋转以及其他夸张的动作来吸引你的注意，这样就可以找到它们了。

#### 5.2.1 清单窗口

清单（Listing）窗口也可以称为反汇编窗口，是查看、操作和分析 Ghidra 生成的反汇编代码的主要工具。它以文本的形式展示了程序的整个反汇编清单，并提供了查看二进制文件中数据区域的主要方法。

图 5-5 是默认配置下 ch5_example1.exe 在 CodeBrowser 中的显示效果。清单窗口左侧的空白提供了有关文件的重要信息，以及你在文件中的位置。清单窗口右侧，也就是紧邻垂直滚动条的右侧，还有一个额外的标记区域，也提供了一些重要信息并具有导航功能。通过滚动条可以看到你在文件中的位置，并可用于导航。在滚动条的右侧是一些包括书签在内的信息展示，提供了文件的更多信息。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_61_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D498b3e2eaf3402f574518df9f1132022aa4a1ab9)

图 5-5：ch5_example1.exe 加载后的默认展示

**你最喜欢的边栏**

在文件自动分析之后，可以使用信息边栏来进行导航和进一步分析。默认情况下，只会显示导航栏。可以使用清单窗口右上角的 Toggle Overview Margin 工具按钮来添加或隐藏概览栏和熵栏，如图 5-6 所示。不管显示哪个栏，左侧的导航标记都会提示你在文件中的位置。单击栏中的任意位置，将会移动到那个位置，并更新清单窗口中的内容。

现在你已经掌握了添加或隐藏边栏的方法，下面介绍每个边栏所展示的内容，以及它们在逆向过程中的应用。

导航标记区域（Navigation Marker area）：用于在文件中移动，但它还有另一个非常重要的功能，即当你右击导航标记区域时，会看到与文件相关联的标记和书签。通过选择或取消标记类型，可以控制导航栏中显示的内容，从而方便地在特定类型的标记中移动（例如高亮部分）。

概览栏（Overview bar）：提供了有关文件内容的重要可视化信息。概览栏中的水平带通过颜色表示程序的各种区域。虽然 Ghidra 提供了与常见类别（如函数、外部饮用、数据和指令）相关的默认颜色，但可以通过 Edit→Tool Options 菜单来更换颜色方案。默认情况下，将鼠标指针悬停在某个区域的时候，可以看到该区域的详细信息，包括区域类型和地址。

熵栏（Entropy bar）：提供了一个 Ghidra 特有的功能——它基于某个位置周围的文件内容，来计算该位置的熵值。一个区域内如果变化很小，会计算得到一个低熵值；如果随机性程度很高，则会计算得到一个高熵值。将鼠标指针悬停在熵栏的水平带上，可以看到该位置的熵值（在 0.0 到 8.0 之间）、区域类型（例如. text）以及在文件中的地址。高度可配置的熵栏可以帮助确定某区域中最有可能是什么内容。有关此功能及其背后的数学原理的更多信息，请参阅 Ghidra 帮助文档。

图 5-6 详细介绍了清单窗口中的各个工具按钮。图 5-7 在清单窗口中将文本的各部分内容做了标记。反汇编代码以线性方式呈现，最左侧的列默认显示其虚拟地址。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_62_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Df518c36c0d8e0f314fa49ba9a59c645e78d1f7ea)

图 5-6：清单窗口中的工具按钮

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_62_2.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3De694ebb5826a61649492caf1c3cab2231e52140b)

图 5-7：带标记的清单窗口

清单窗口中的几个部分值得注意。最左侧的灰色带是边界标记，用于指示你在文件中的当前位置，包括点标记和区域标记，这些在 Ghidra 帮助文档中有具体描述。在本例中，当前文件位置（004011b6）在边界标记中是一个黑色的小箭头。

紧邻边界标记右侧的区域用于以图形化的方式描述函数内的非线性流 [[1]](https://book.qq.com/book-read/Text/Section0010.xhtml#nF6A2003E8C034858A730BF0872551856)。当控制流指令的源地址和目标地址在清单窗口中可见时，就会出现相关的流箭头。实线箭头表示无条件跳转，虚线箭头表示有条件跳转。将鼠标指针在流箭头上悬停，会打开工具提示，上面显示有流的起始地址、结束地址和类型。当跳转（有条件或无条件）将控制权转移到一个靠前的地址时，通常表示出现了循环。图 5-7 中展示了从地址 004011cf 到 004011c5 的流箭头。通过双击流箭头可以跳转到相应的起始地址或结束地址。

图 5-7 顶部的声明是 Ghidra 对函数栈帧 [[2]](https://book.qq.com/book-read/Text/Section0010.xhtml#n44C8003EF14C4B1E8174EADB2E5E505A) 布局的预测。Ghidra 通过对函数中用到的栈指针和栈帧指针的行为进行详细分析，来计算函数栈帧的结构（局部变量）。关于栈帧的更多细节会在第 6 章中讲解。

清单中通常有大量的数据和代码的交叉引用，使用 XREF 标记，如图 5-7 右侧所示。每当反汇编代码中的一个位置引用了反汇编代码中的另一个位置时，就会创建一个交叉引用。例如，A 地址处的指令跳转到 B 地址处的指令，将会创建一个从 A 到 B 的交叉引用。将鼠标指针悬停在引用地址上，会出现一个显示引用地址的窗口。该窗口的布局与清单窗口相同，但背景是黄色的，类似于一个弹出的工具提示。通过该窗口可以查看反汇编内容，但不允许再查看其引用。关于交叉引用的更多细节会在第 9 章中讲解。

#### 5.2.2 创建额外的反汇编窗口

如果想要同时查看两个函数的清单，只需要单击清单工具栏上的快照按钮，来打开另一个反汇编窗口（参见图 5-6）。打开的第一个反汇编窗口在文件名之前有前缀 Listing：，所有后续的反汇编窗口都以 [Listing：<filename>] 作为标题，以表明它们是独立的，与主显示没有关联。快照都是无链接的，因此可以在不影响其他窗口的情况下自由浏览。

**配置清单窗口**

一个反汇编清单可以分解为多个组成字段，包括助记符字段、地址字段和注释字段等。到目前为止我们看到的清单都是由一组默认字段组成的，这些字段提供了关于文件的一些重要信息。然而，有时默认视图无法提供你想看到的某些信息，那么就需要使用浏览器字段格式化器（Browser Field Formatter）。

浏览器字段格式化器允许对 30 多个字段进行自定义，以确保你能够完全控制清单窗口的外观，单击清单工具栏上的相应按钮即将其可打开（参见图 5-6）。如图 5-8 所示，这是一个强大的子菜单和布局编辑器，位于清单的顶部。浏览器字段格式化器可以控制地址中断、函数头部注释、函数、变量、指令、数据、结构体和数组的外观。在每个类别中都有可以调整和控制的字段，从而创建一个完美的清单格式。本书我们会继续使用清单的默认视图，但应该尝试探索不同的格式，以确定是否有哪个选项可以帮助更好地理解清单的内容。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_64_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Ddc8eaf8d291f39fb35a3f6b992b2adc5fc1db07a)

图 5-8：清单窗口开启浏览器字段格式化器

#### 5.2.3 函数图形化视图

虽然反汇编清单包含了丰富的信息，但通过查看图形化的函数视图（Function Graph），能够更容易地理解程序流。在 CodeBrowser 中选择 Window→Function Graph 或者在工具栏上单击对应的按钮，可以打开函数图窗口。图 5-7 中的函数所对应的函数图窗口如图 5-9 所示。图形视图会让人联想到程序流图，在那里函数被分解为基本块 [[3]](https://book.qq.com/book-read/Text/Section0010.xhtml#n48404C4E869942558B0231ED92107500)，可以看到函数的控制流从一个块到另一个块。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_65_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dcd1a1b18bfb742f51d4a3d3ea82353b6d1fd1f7d)

图 5-9：图 5-7 中函数的图形化视图

在屏幕上，Ghidra 使用不同颜色的箭头来区分基本块之间不同类型的流。此外，流会在鼠标指针悬停在上面的时候变成动画，以指示方向。以有条件跳转结束的基本块有两种流向：绿色箭头表示条件满足，红色箭头表示条件不满足。只有一个流向的基本块，则以蓝色箭头表示。单击任意箭头可以查看从一个块到另一个块如何关联和跳转。由于默认情况下图形和清单工具是同步的，所以在两个视图之间切换的时候，文件位置通常会保持一致。例外情况将在第 10 章和 Ghidra 帮助文档中讲解。

在图形模式下，Ghidra 每次只显示一个函数。Ghidra 通常使用传统的图像交互技术（如平移和缩放）来方便查看和导航。但是对于大型或者复杂函数，图形导航使用起来还是比较困难，此时位于图形窗口右下角的卫星视图就发挥作用了，它会帮助你更好地把握全局。（参见图 5-9）

**卫星导航**

卫星视图总是显示图形的完整块结构，并将当前反汇编窗口对应的图形区域高亮显示。单击卫星视图的任意位置，图形视图将会围绕该位置居中显示。高亮图层可以在卫星视图上拖动，以快速查看图形视图上的任意位置。除了导航图形窗口的功能，这个神奇的窗口还可以在查看文件时提供其他帮助。

当然这个窗口也会占用函数图窗口的宝贵空间，有时会挡住你想查看的块，解决方法有两种。第一种方法是右击卫星视图，取消 Dock Satellite View 复选框。这时卫星视图及其全部功能会被移出函数图窗口，重新选中该复选框可以恢复。第二种方法是取消 Display Satellite View 复选框，将其隐藏起来，此时右下角会出现一个小图标，单击此图标可以恢复。

另外，卫星视图可见时，可能会拖慢主视图的运行速度，将其隐藏可以让响应更快。

**使工具连接起来**

工具可以独立工作，也可以连接起来一起工作。我们已经看到了清单窗口和函数图窗口是如何共享数据，并将一个窗口中发生的事件传递到另一个窗口的。如果你在函数图窗口中选择了一个特定块，相应的代码将在清单窗口中高亮显示。反过来，在清单窗口中的函数之间的导航也会改变函数图窗口的视图。很多工具之间都有这样的双向连接，还有一些工具连接是单向的，以及通过与工具事件相关的生产者 / 消费者模型手动连接和断开的。在本书中，我们主要关注 Ghidra 提供的双向工具自动连接。

除了使用卫星视图导航，还可以在函数图窗口中以多种方式操作视图，以满足工作需要。

**平移**：首先，除了使用卫星视图快速重定位图形外，还可以单击并拖动背景来重新定位图形，以改变图形视图。

**缩放**：可以使用键盘的传统方式进行放大和缩小，例如 CTRL/COMMAND，滚动鼠标或相关的热键。如果图形被缩得太小，就可能会超过阈值而不再显示块内容，此时每个块都会变成一个有颜色的矩形图案。在某些情况下缩小是有好处的，特别是与清单窗口并排工作时，可以提高函数图的相应速度。

**重新排列**：通过单击所需块的标题栏并将其拖动到新位置，可以重新排列图形。块之间所有的连接在移动时都会保留下来。在任何时候都可以通过函数图工具栏中的刷新按钮来将其恢复到默认布局。

**分组和折叠**：块可以单独或与其他块在一起进行分组，并自动折叠以减少视图的混乱。将已经分析过的块折叠起来，可以方便跟踪。方法是单击块工具栏最右边的组按钮。当选中了多个块并单击组按钮的时候，它们将被折叠，相关块的列表显示在堆叠窗口中。关于组的操作及详细内容可以查看 Ghidra 帮助文档。

**自定义图形显示**

为了帮助分析，Ghidra 在函数图中每个节点的顶部提供了一个菜单栏，可以控制特定节点的显示。包括节点的背景 / 文本颜色、XREF 跳转、查看图形节点的完整清单，以及使用分组功能来组合并折叠节点（注意，在函数图中更改块的背景也会同时更改清单窗口中的背景）。如果你喜欢将清单窗口和函数图窗口结合使用，那么其中一些功能可能是用不到的，但是自定义选项还是会有所帮助，值得研究。这些选项会在第 10 章中进一步讲解。

由于基于图形化的界面是在 CodeBrowser 之外的窗口中打开的，所以你可以将两个窗口并排查看。因为窗口之间是有连接的，因此改变其中一个窗口中的位置，也会改变另一个窗口中的位置，这样你就可以用两个视图来查看可视化程序流。此外，请记住这里的例子只是一小部分，你可以对图形和文本视图做更多的控制。关于图形的更多功能会在第 10 章中讲解，关于视图选项的更多信息则可以查看 Ghidra 帮助文档。

在接下来的内容中，我们主要关注示例的清单显示，并以图形显示作为补充。第 6 章讲解 Ghidra 反汇编代码，第 7 章讲解如何控制清单显示，以便整理和注释反汇编代码。

**到处看看**

除了传统的文件导航方式（向上箭头、向下箭头、页面向上、页面向下），Ghidra 还提供了专门用于逆向工程的导航工具。导航工具栏上的按钮（如图 5-10 所示）可以让你可以方便地在程序中移动。下面让我们来看看这些为逆向工程师服务的按钮。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_67_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Df16c68bdf209de47405ae432236829c61ffff78b)

图 5-10：导航工具栏

最左侧的是方向按钮，该箭头在向上和向下之间切换，用于控制其他所有导航图标的方向。接下来的八个图标将帮助你达成导航目标，如图 5-11 所示。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_67_2.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D4f788811dfb7b9e113be6a490dd26e6843a71b50)

图 5-11：导航工具图标

单击 “Data” 按钮会跳过相邻数据，将你带到下一个不相邻数据的开头。Instruction 和 Undefined 按钮也是同样的。

单击导航工具栏最右侧的下拉箭头会显示一个列表，用于在特定的书签类型中快速导航。这些导航热键主要用于清单列表，也可以用于与清单列表相链接的所有窗口。在这些窗口中导航会同步到与之相连的所有窗口中。

#### 5.2.4 程序树窗口

让我们回到 CodeBrowser 的默认窗口中来，简单看一下程序树（Program Trees）窗口，如图 5-12 所示。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_68_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dcbb395b2197c90466e02d0de9b366e8557be24be)

图 5-12：程序树窗口

此窗口将程序组织成文件夹和段，提供了在自动分析期间细化组织的能力。段（fragment）在 Ghidra 中代表一段连续的地址，且互相之间是不重叠的。段更传统的名称是程序节（program section），例如. text、.data 和. bss。程序树相关的操作包括：

· 创建文件夹 / 段

· 展开 / 折叠 / 合并文件夹

· 添加 / 删除文件夹 / 段

· 识别清单窗口中的内容并移到段中

· 按名称 / 地址排序

· 复制 / 剪切 / 粘贴段 / 文件夹

· 重新排列文件夹

程序树窗口是一个链接窗口，因此单击窗口中的任意段会将你带到清单窗口中的对应位置。关于程序树窗口的更多信息可以查看 Ghidra 帮助文档。

#### 5.2.5 符号树窗口

当你将文件导入 Ghidra 项目中时，会选择一个 Ghidra 加载器来加载文件内容。如果符号表存在，加载器就会将其信息从二进制文件中提取出来，并显示在符号树（Symbol Tree）窗口中，如图 5-13 所示。符号树窗口包括与程序相关的导入（Imports）、导出（Exports）、函数（Functions）、标签（Labels）、类（Classes）和命名空间（Namespaces）。这些类别以及相关的符号类型都会在后续章节中讲解。

所有这六个符号树文件夹都可以通过底部的过滤器进行控制。如果你了解待分析的文件，那么这个功能会更有价值。此外，你会发现符号树窗口提供的功能类似于一些命令行工具，例如 objdump（-T）、readelf（-s）和 dumpbin（/EXPORTS）。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_69_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Da743ac272e92783f418fbefeedc54f38f6f40ce4)

图 5-13：符号树窗口

**导入**

符号树窗口中的导入文件夹列出了被分析二进制文件的所有导入函数。只有当二进制文件使用了共享库时，这个功能才有意义，因为静态链接的二进制文件没有外部依赖关系，也就没有导入函数。导入文件夹列出了导入的库，以及从该库中导入的每一项（函数或数据）的入口。单击符号树窗口中的任意符号，将显示其相关的所有信息。在 Windows 二进制文件示例中，单击导入文件夹中的 GetModuleHandleA，反汇编窗口将跳转到 GetModuleHandleA 函数的导入地址表入口处，在本例中是 0040e108 地址，如图 5-14 所示。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_69_2.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dc9bd194aab021dc2776ad7c48f468d7c35012130)

图 5-14：导入地址表入口和对应的清单窗口

需要注意的是，导入文件夹中只显示二进制文件在导入表中定义的符号，而使用 dlopen/dlsym 或者 LoadLibrary/GetProcAddress 等机制导入的符号是不会在符号树窗口中列出的。

**导出**

导出文件夹列出了文件的入口点，包括在文件头中定义的程序执行入口点，以及文件导出供给其他文件使用的所有函数和变量。导出的函数常见于共享库中，例如 Windows DLL 文件。导出的入口按名称列出，单击一个导出项时，相应的虚拟地址会在清单窗口高亮显示。对于可执行文件，导出文件夹中至少包含一项，即程序执行入口点。Ghidra 根据二进制文件类型，将其命名为 entry 或者_start。

**函数**

函数文件夹包含 Ghidra 在二进制文件中识别到的所有函数列表。将鼠标指针悬停在函数名上，会弹出一个显示该函数详细信息的窗口，如图 5-15 所示。作为加载过程的一部分，加载器利用各种算法，包括文件结构分析和字节序列匹配，来推断创建该文件的编译器。在分析阶段，Function ID 分析器利用编译器标识信息执行基于哈希的函数体匹配，以识别是否存在链接到该二进制文件的库函数。如果一个哈希被匹配上，Ghidra 将从哈希数据库（包含在 Ghidra 的. fidbf 文件中）中检索匹配到的函数名，并将其添加为函数符号。哈希匹配对去除了符号信息的二进制文件特别有用，因为它提供了一种独立于符号表的符号恢复方法。关于此功能的更多信息会在 13.5 节的 “Function ID 分析器” 中讲解。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_70_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D1eb1005877e20db6107a9978a6a476053cd4596f)

图 5-15：符号树函数文件夹弹出窗口

**标签**

标签文件夹相当于是函数文件夹的数据。二进制文件的符号表中所包含符号的所有数据都存放在标签文件夹中，此外，每当你向数据地址添加了新标签名时，该标签都会被添加到符号文件夹中。

**类**

类文件夹包含 Ghidra 在分析阶段识别到的所有类条目。在每个类下面，Ghidra 列出了可以帮助理解该类行为的数据和方法。C++ 类和类文件夹的结构会在第 8 章中详细讲解。

**命名空间**

在命名空间文件夹中，Ghidra 可能会创建新的命名空间，以提供组织并确保分配的名称在二进制文件中不会冲突。例如，可以为每个已识别的外部库或者使用跳转表的每个 switch 语句创建命名空间（在其他 switch 语句中重用跳转表标签不会发生冲突）。

#### 5.2.6 数据类型管理器窗口

通过数据类型存档系统，数据类型管理器（Data Type Manager）窗口可以定位、组织和将数据类型应用到文件。存档是 Ghidra 从最常见的编译器所包含的头文件中收集到的预定义数据类型。通过处理头文件，Ghidra 可以获得常见库函数的参数类型，并将其注释到对应的反汇编和反编译代码清单中。同样地，通过这些头文件，Ghidra 可以获得复杂数据类型的大小和布局。所有这些信息都被收集到存档文件中，并用于二进制文件分析。

回到图 5-4，即使没有加载文件，也可以在 CodeBrowser 左下角的数据类型管理器窗口中看到 BuiltInTypes 树的根目录，它包含像 int 这样的原始类型，不能在数据类型存档中修改、重新命名或者移动。除了内置类型，Ghidra 还支持创建用户自定义的数据类型，包括结构体、联合体、枚举类型和 typedef 类型；它还支持将数组和指针作为派生数据类型。

你打开的每个文件在数据类型管理器窗口中都有一个关联文件夹，如图 5-5 所示。该文件夹以所关联的文件命名，其下所有的条目都是该文件独有的。

数据类型管理器窗口会显示打开的每个数据类型存档的节点。当一个程序引用了某个存档时，该存档会被自动打开，当然也可以由用户手动打开。关于数据类型和数据类型管理器的更多内容会在第 8 章和第 13 章中讲解。

#### 5.2.7 控制台窗口

CodeBrowser 窗口底部的控制台（Console）窗口是 Ghidra 插件和脚本（包括自己开发的）的输出区域，在这里可以查看到 Ghidra 正在执行的任务信息。插件和脚本开发会在第 14 章和第 15 章中讲解。

#### 5.2.8 反编译器窗口

通过清单窗口和反编译器（Decompiler）窗口的连接，可以同时查看和操作二进制文件的汇编代码和 C 代码。虽然 Ghidra 反编译器生成的 C 代码不总是完美的，但对于帮助我们理解二进制文件非常有用。反编译器提供的基本功能包括表达式、变量、函数参数和结构体的恢复，它通常还能够恢复函数的基本块结构，这一点只从汇编代码中是很难看清楚的，因为汇编代码不是块结构的，并且广泛使用了 goto（或类似的）语句。

反编译器窗口将清单窗口中选中的函数转换成 C 语言，通常来说会比汇编语言更容易理解。如图 5-16 所示，即使是初学者也应该能看出反编译函数里的无限循环（while 循环条件取决于 param_3 的值，而这个值在循环内是保持不变的）。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_72_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dd880f6876a6607f5a5b31bee3a3b770101b468f7)

图 5-16：清单和反编译器窗口

反编译器窗口中的按钮如图 5-17 所示。如果想同时查看多个反编译函数或者同一函数的多个版本，可以使用快照功能打开其他的反编译器窗口，这些窗口是断开连接的，不跟随清单窗口变化。窗口上的导出按钮可以将反编译函数保存为 C 文件。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_72_2.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D7b58e83ea4abb30971f405eb1a36cff464263ca0)

图 5-17：反编译器窗口工具栏

在反编译器窗口中，右击打开上下文菜单，可以对选中高亮的代码进行操作。与函数参数 param_1 关联的选项如图 5-18 所示。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_73_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dfba9c3b697fa527b3d15e8741b9e6cbb090e5a09)

图 5-18：函数参数的反编译器窗口选项

反编译是一个非常复杂的过程，反编译理论研究一直是一个活跃的研究领域。反汇编的准确性可以通过制造商的参考手册进行验证，但对于反编译，并没有一套从汇编语言到 C 语言（或者从 C 语言到汇编语言）的参考手册。事实上，虽然 Ghidra 的反编译器总是生成 C 语言，但被分析的二进制文件可能是由 C 以外的语言开发的，所以反编译器很多针对 C 语言的假设是不成立的。

作为一个很复杂的插件，反编译器输出的质量在很大程度上取决于输入的指令。很多反编译器窗口中的问题和不正常现象都可以追溯到底层反汇编的问题，因此，如果反编译代码出现问题，你可能需要花点时间提高反汇编的质量。在大多数情况下，这涉及用更准确的数据类型信息去注释反汇编代码（将在第 8 章和第 13 章中讲解）。在后续章节中我们会继续探索反编译器的功能，并在第 19 章中更深入地讲解。

### 5.3 其他窗口

除了六个默认窗口，还可以在逆向过程中打开其他窗口，通过多种视图来查看分析文件。可用窗口的列表在 Window 菜单中，如图 5-4 所示。这些视图是否有用取决于正在分析的二进制文件的特征，以及你对 Ghidra 的使用情况。其中一些窗口非常专业，会在后续章节中详细介绍，这里简单介绍一些常见窗口。

#### 5.3.1 字节窗口

字节（Bytes）窗口提供了文件字节级内容的原始视图。默认情况下，字节窗口会在 CodeBrowser 的右上角打开，并提供了标准十六进制转储的显示，每行 16 字节。该窗口同时也是十六进制编辑器，通过字节窗口工具栏中的设置工具可以配置多种显示格式。在许多情况下，将 ASCII 显示添加到字节窗口中可能会有所帮助，如图 5-19 所示。图中还展示了 Byte Viewer Options 对话框和工具栏图标，用于编辑或对字节视图创建快照。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_74_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Df446246be6da1f8934a011b75d151315fb50a782)

图 5-19：同步的十六进制和反汇编视图

与清单窗口一样，可以使用字节窗口工具栏的快照按钮（参见图 5-19）同时打开多个字节窗口。默认情况下，第一个字节窗口是与清单窗口连接的，因此在一个窗口中滚动并单击元素也会让另一个窗口滚动到相同位置（相同虚拟地址）。后续的字节窗口则是断开连接的，可以独立地滚动它们。无连接窗口的窗口名称位于方括号内。

切换图 5-19 中高亮显示的铅笔按钮，可以将字节窗口变成十六进制（或 ASCII）编辑器。此时光标变为红色，表示可以编辑，但包含现有代码项（如指令）的地址处是不允许编辑的。编辑完成后，再次切换按钮即可返回只读模式（请注意，任何更改都不会影响断开连接的字节窗口）。

如果十六进制列显示的不是十六进制值而是问号，说明 Ghidra 不确定这些虚拟地址中可能包含哪些值。例如，当程序包含 bss[[4]](https://book.qq.com/book-read/Text/Section0010.xhtml#nD26ED609E1DF43AC8FF3B9F32771E3B3) 节时，它通常不占用文件中的空间，但加载器会对其进行扩展，以满足程序的静态存储需求。

#### 5.3.2 数据定义窗口

数据定义（Defined Data）窗口显示当前程序、视图和选择中所定义数据的字符串表示，以及相关的地址、类型和大小，如图 5-20 所示。与大多数列式窗口一样，可以单击列头按升序或降序对任意列进行排序。双击数据定义窗口中的任何一行，可以让清单窗口跳转到所选项目的地址。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_75_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D1e0ccaeea9bb2a699b545993175f58878509c9dd)

图 5-20：数据定义窗口及过滤按钮

当与交叉引用一起使用时（在第 9 章讨论），数据定义窗口提供了一种方法，可以快速发现你感兴趣的项，并且只需单击几下就可以跟踪到程序中引用该项的位置。例如，你可能会看到字符串 “SOFTWARE\Microsoft\Windows\Current Version\Run”，并想知道为什么程序会引用 Windows 注册表中的这个特定键，然后你发现这个程序正在设置注册表项，以便在 Windows 启动时自动启动。

数据定义窗口具有广泛的过滤功能，除了窗口底部的过滤栏，右上角的过滤图标（参见图 5-20）还可以控制其他数据类型的过滤选项，如图 5-21 所示。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_75_2.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dfca11f70bd8991c2eb5fb45a6428e44ff0b115e6)

图 5-21：数据定义类型过滤器选项

每次单击 “OK” 按钮关闭 Set Data Type Filter 对话框时，Ghidra 将根据新设置重新生成数据定义窗口的内容。

#### 5.3.3 字符串定义窗口

字符串定义（Defined Strings）窗口用于显示二进制文件中定义的字符串，示例如图 5-22 所示。除了图中显示的默认列，还可以右击列标题行来添加其他列。其中最有趣的可用列可能是 Has Encoding Error 标志，用于指示字符集或字符串的错误识别问题。除了字符串定义窗口，Ghidra 还提供了很多字符串搜索功能，在第 6 章中再讲解。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_76_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D14e908e05667e9bb3cae4c0f3861480ae681bff5)

图 5-22：字符串定义窗口

#### 5.3.4 符号表和符号引用窗口

符号表（Symbol Table）窗口提供了二进制文件中所有全局名称的摘要列表。默认显示 8 列，如图 5-23 所示。该窗口是高度可配置的，可以任意添加和删除列，也可以对任意列按升序或降序排列。前两个默认列是名称和位置，名称是对某个位置定义的符号的描述。

符号表与清单窗口相连，但提供了控制其与清单窗口交互的功能。图 5-23 右侧高亮的图标是一个切换按钮，决定了单击符号表窗口中的符号是否会同时移动清单窗口的相关位置。无论选择哪种切换方式，双击任意符号都会立即跳转到清单视图，并显示所选符号的信息。这为快速导航到程序清单中的已知位置提供了一个有用的工具。

符号表窗口提供了广泛的过滤功能，以及多种访问过滤选项的方法。工具栏上的齿轮按钮可以打开符号表过滤对话框。该对话框（勾选 Use Advanced Filters）如图 5-24 所示。除此之外，还可以使用窗口底部的过滤器选项。关于符号表过滤选项的更多内容可以查看 Ghidra 帮助文档。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_77_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Df4d02efb31e1f8827b841d6ac6e17729815c28f7)

图 5-23：符号表窗口及符号引用和导航切换按钮

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_77_2.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D451fe3adf24b65aeee6c2943086350eb102b432c)

图 5-24：符号表过滤器对话框

图 5-23 左侧高亮的图标是显示符号引用图标。单击此图标可以将符号引用（Symbol References）窗口添加到符号表窗口。默认情况下，这两个窗口会并排显示。为了提高可读性，可以将符号引用窗口拖到符号表窗口的下方，如图 5-25 所示。这两个窗口之间的连接是单向的，当在符号表中进行选择时，符号引用表会同时更新。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_78_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3Dd54508c7fd9844984679b34002d84745535ff9f1)

图 5-25：符号表和符号引用窗口

与符号表窗口一样，符号引用窗口具有相同的列控制方法。此外，符号引用窗口的内容由符号引用工具栏右上方的三个按钮（S、I 和 D）所控制。这些选项是互斥的，每次只能选择其中的一个。

**S 按钮**：选择此按钮时，符号引用窗口将显示你在符号表中所选择符号的所有引用。图 5-25 是选择此选项的符号引用窗口。

**I 按钮**：选择此选项时，符号引用窗口将显示你在符号表中所选择函数的所有指令引用。如果没有选择函数入口点，此列将为空。

**D 按钮**：选择此选项时，符号引用窗口将显示你在符号表中所选择函数的所有数据引用。如果没有选择函数入口点，或者该函数没有引用任何数据符号，此列将为空。

#### 5.3.5 内存映射窗口

内存映射（Memory Map）窗口用于显示程序中内存块的摘要列表，如图 5-26 所示。请注意，在讨论二进制文件的结构时，Ghidra 所说的内存块（memory blocks）通常称为节（sections）。窗口中显示的信息包括内存块（节）名称、起始和结束地址、长度、权限标志、块类型、初始化标志，以及源文件名和用户注释的空间。起始和结束地址表示虚拟地址范围，程序节在运行时将被映射到该地址。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_78_2.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3De1fedef4b9e19f8ba246ab57287a1ae1b17ebdcf)

图 5-26：内存映射窗口

双击窗口中的任意起始或结束地址，将使清单窗口（以及所有其他连接的窗口）跳转到指定地址。内存映射窗口工具栏提供了添加 / 删除块、移动块、分割 / 合并块、编辑地址和设置新映像的基地址的选项。这些功能在对非标准格式的文件进行逆向工程时非常有用，因为 Ghidra 加载器可能检测不到二进制文件的段结构。

与内存映射窗口对应的命令行工具包括 objdump（-h）、readelf（-S）和 dumpbin（/HEADERS）。

#### 5.3.6 函数调用图窗口

在程序中，一个函数既可以调用其他函数，也可以被其他函数调用。函数调用图（Function Call Graph）窗口用于显示指定函数的直接调用关系。当函数调用图窗口打开时，Ghidra 会确定光标所在函数的直接调用关系，并生成相关显示。该显示是一个函数在程序文件中的使用情况，但它只是整个大画面的一部分。

图 5-27 显示了一个名为 FUN_0040198c 的函数，它被函数 FUN_00401edc 调用，并调用了其他 6 个函数。双击窗口中的任意函数，清单窗口和其他连接窗口将立即跳转到所选函数的位置。Ghidra 交叉引用（XREF）是生成函数调用图窗口的基础机制，更多内容会在第 9 章中讲解。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_79_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D263947a426880e136ab0d2c5e72522037cf8a1dc)

图 5-27：函数调用图窗口

**谁是调用者？**

虽然函数调用图窗口很有用，但有时你需要更大的视角。函数调用树窗口（Function Call Trees）可以看到某个选定函数调用和被调用的所有调用关系。函数调用树窗口（如图 5-28 所示）有两个部分：一个用于查看调用关系，另一个用于查看被调用关系。两个部分都可以根据需要展开和折叠。

![](https://epubserver-1252317822.cos.ap-shanghai.myqcloud.com/C9D5D1/25638894401717006/epubprivate/OEBPS/Images/44551_80_1.jpg?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDulTzKUTIxRj5HF2X2TkyFPOJJg7ykMmz%26q-sign-time%3D1693538920%3B1693546120%26q-key-time%3D1693538920%3B1693546120%26q-header-list%3D%26q-url-param-list%3D%26q-signature%3D2c9226677c69ca75c7da7e5ee42dd99a0fd2ffbb)

图 5-28：函数调用树窗口

如果函数调用树窗口的被选函数是程序入口函数，那么你就可以查看整个程序函数调用的分层结构。

### 5.4 小结

乍一看，Ghidra 提供的显示窗口数量还挺多的。你可能会发现坚持使用默认窗口是最容易的，直到有一天你开始不满足于此并开始探索其他的显示窗口。无论如何，都应该选择对自己最有用的窗口，因为并不是它们中的每一个都能在逆向工程场景中发挥作用。

熟悉 Ghidra 显示窗口的一个最好方法，是浏览各种选项卡子窗口，并打开一些其他的可用窗口，它们包含了 Ghidra 为二进制文件生成的各种数据。随着你对 Ghidra 越来越熟悉，逆向工程的效果和效率也将得到提高。

Ghidra 是一个非常复杂的工具，除了本章介绍的窗口之外，你在使用中还会遇到其他对话框。在本书的剩余部分，我们会继续介绍一些关键对话框。

到这里，你应该已经熟悉 Ghidra 界面和 CodeBrowser 桌面了。在下一章中，我们将开始关注控制反汇编的多种方法，以增强对程序行为的理解，并让你在使用 Ghidra 时更加轻松。

[[1]](https://book.qq.com/book-read/Text/Section0010.xhtml#nF6A2003E8C034858A730BF0872551856s) Ghidra 使用流（flow）来表示如何从给定指令继续执行。常规（normal 或 ordinary）流表示指令按默认的连续地址执行，跳转（jump）流表示指令跳转到一个不连续的地址执行。调用（call）流表示指令调用子例程。

[[2]](https://book.qq.com/book-read/Text/Section0010.xhtml#n44C8003EF14C4B1E8174EADB2E5E505As) 栈帧（stack frame 或 activation record）是程序在运行时在栈上分配的一块内存，包含传递给函数的参数和函数中声明的局部变量。栈帧在进入函数时分配，在退出函数时释放。

[[3]](https://book.qq.com/book-read/Text/Section0010.xhtml#n48404C4E869942558B0231ED92107500s) 基本块（basic block）是一段指令的最大序列，它从头到尾执行，没有分支。每个基本块都有一个入口点（块中的第一条指令）和一个出口点（块中的最后一条指令）。入口点通常是分支指令的目标，出口点通常是分支指令。

[[4]](https://book.qq.com/book-read/Text/Section0010.xhtml#nD26ED609E1DF43AC8FF3B9F32771E3B3s) bss 节由编译器创建，用于存放程序中所有未初始化的静态变量。由于这些变量没有赋值，不需要在程序的文件映像中为它们分配空间，因此该节的大小会在程序头中注明。当程序执行时，加载器将为其分配所需的空间，并将整个块初始化为零。